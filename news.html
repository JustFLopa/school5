<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–æ–≤–æ—Å—Ç–Ω–∞—è –ª–µ–Ω—Ç–∞</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
</head>
<body>

    <button class="back-button" onclick="goBack()">‚¨Ö –ù–∞–∑–∞–¥</button>

    <div class="hero-container">
        <h1>–ù–æ–≤–æ—Å—Ç–Ω–∞—è –ª–µ–Ω—Ç–∞</h1>
        <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –Ω–æ–≤–æ—Å—Ç–∏ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.</p>
    </div>

    <div id="newsContainer"></div>

    <button class="add-news-button" onclick="openModal()">+</button>

    <div class="modal" id="newsModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ—Å—Ç—å</h2>
            <form id="newsForm" onsubmit="saveNews(event)">
                <input type="text" id="newsTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏" required>
                <textarea id="newsDescription" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏" rows="4" required></textarea>
                <input type="file" id="newsImage" accept="image/*" required>
                <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
            </form>
        </div>
    </div>

    <script>
        // üî• –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCTyP_LnocMjbmP6f9hsML2fDIZBCoTSdc",
            authDomain: "school5-5624f.firebaseapp.com",
            databaseURL: "https://school5-5624f-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "school5-5624f",
            storageBucket: "school5-5624f.firebasestorage.app",
            messagingSenderId: "437123904178",
            appId: "1:437123904178:web:1057faef61db3dfb888fab"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function openModal() {
            document.getElementById("newsModal").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("newsModal").style.display = "none";
        }

        function saveNews(event) {
            event.preventDefault();

            const title = document.getElementById('newsTitle').value;
            const description = document.getElementById('newsDescription').value;
            const image = document.getElementById('newsImage').files[0];

            if (!title || !description || !image) {
                alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const newsItem = {
                    title: title,
                    description: description,
                    image: e.target.result,
                    timestamp: Date.now()
                };

                db.ref("news").push(newsItem, function(error) {
                    if (error) {
                        alert("–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è");
                    } else {
                        closeModal();
                        document.getElementById('newsForm').reset();
                        displayNews();
                    }
                });
            };

            reader.readAsDataURL(image);
        }

        function deleteNews(newsId) {
            db.ref("news/" + newsId).remove().then(() => {
                displayNews();
            }).catch(error => {
                alert("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è");
            });
        }

        function displayNews() {
            const newsContainer = document.getElementById('newsContainer');
            newsContainer.innerHTML = '';

            db.ref("news").orderByChild("timestamp").on("value", function(snapshot) {
                newsContainer.innerHTML = '';
                snapshot.forEach(function(childSnapshot) {
                    const news = childSnapshot.val();
                    const newsElement = document.createElement('div');
                    newsElement.classList.add('news-item');

                    newsElement.innerHTML = `
                        <h3>${news.title}</h3>
                        <p>${news.description}</p>
                        <img src="${news.image}" alt="News image">
                        <button class="delete-button" onclick="deleteNews('${childSnapshot.key}')">‚úñ</button>
                    `;

                    newsContainer.appendChild(newsElement);
                });
            });
        }

        function goBack() {
            window.location.href = "index.html";
        }

        window.onload = displayNews;
    </script>

</body>
</html>
